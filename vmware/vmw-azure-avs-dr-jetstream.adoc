---
sidebar: sidebar 
permalink: vmware/vmw-azure-avs-dr-jetstream.html 
keywords: NetApp Solutions, microsoft azure, avs, azure, anf, azure netapp files, ontap, disaster recovery, dr 
summary:  
---
= ANFとJetStreamによる災害復旧
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
クラウドへの災害復旧は、サイトの停止やデータ破損イベント (ランサムウェアなど) からワークロードを保護する、回復力がありコスト効率に優れた方法です。  VMware VAIO フレームワークを使用すると、オンプレミスの VMware ワークロードを Azure Blob ストレージに複製して回復できるため、データ損失を最小限に抑えるか、ほぼゼロにすることができ、RTO はほぼゼロになります。

JetStream DR を使用すると、オンプレミスから AVS、具体的にはAzure NetApp Filesに複製されたワークロードをシームレスに回復できます。  DR サイトでの最小限のリソースとコスト効率の高いクラウド ストレージを使用することで、コスト効率の高い災害復旧が可能になります。  JetStream DR は、Azure Blob Storage を介して ANF データストアへのリカバリを自動化します。  JetStream DR は、ネットワーク マッピングに従って、独立した VM または関連する VM のグループをリカバリ サイト インフラストラクチャに復元し、ランサムウェア保護のためのポイントインタイム リカバリを提供します。

このドキュメントでは、JetStream DR の動作原理と主なコンポーネントについて説明します。

.ソリューション展開の概要
[%collapsible%open]
====
. オンプレミスのデータ センターに JetStream DR ソフトウェアをインストールします。
+
.. Azure Marketplace (ZIP) から JetStream DR ソフトウェア バンドルをダウンロードし、指定されたクラスターに JetStream DR MSA (OVA) をデプロイします。
.. I/O フィルター パッケージを使用してクラスターを構成します (JetStream VIB をインストールします)。
.. DR AVS クラスターと同じリージョンに Azure Blob (Azure ストレージ アカウント) をプロビジョニングします。
.. DRVA アプライアンスを展開し、レプリケーション ログ ボリューム (既存のデータストアまたは共有 iSCSI ストレージからの VMDK) を割り当てます。
.. 保護されたドメイン (関連する VM のグループ) を作成し、DRVA と Azure Blob Storage/ANF を割り当てます。
.. 保護を開始します。


. Azure VMware Solution プライベート クラウドに JetStream DR ソフトウェアをインストールします。
+
.. 実行コマンドを使用して、JetStream DR をインストールおよび構成します。
.. 同じ Azure Blob コンテナーを追加し、[ドメインのスキャン] オプションを使用してドメインを検出します。
.. 必要な DRVA アプライアンスを展開します。
.. 利用可能な vSAN または ANF データストアを使用してレプリケーション ログ ボリュームを作成します。
.. 保護されたドメインをインポートし、VM 配置に ANF データストアを使用するように RocVA (回復 VA) を構成します。
.. 適切なフェイルオーバー オプションを選択し、RTO がほぼゼロのドメインまたは VM の継続的なリハイドレーションを開始します。


. 災害発生時に、指定された AVS DR サイト内のAzure NetApp Filesデータストアへのフェールオーバーをトリガーします。
. 保護されたサイトが回復された後、保護されたサイトへのフェイルバックを呼び出します。開始する前に、この前提条件が満たされていることを確認してください。 https://docs.microsoft.com/en-us/azure/azure-vmware/deploy-disaster-recovery-using-jetstream["リンク"^]また、JetStream Software が提供する帯域幅テスト ツール (BWT) を実行して、JetStream DR ソフトウェアと併用した場合の Azure Blob ストレージの潜在的なパフォーマンスとレプリケーション帯域幅を評価します。接続などの前提条件が整ったら、JetStream DR for AVSをセットアップしてサブスクライブします。 https://portal.azure.com/["Azureマーケットプレイス"^] 。ソフトウェア バンドルをダウンロードしたら、上記のインストール プロセスに進みます。


====
多数の VM (たとえば、100 台以上) の保護を計画して開始する場合は、JetStream DR Automation Toolkit の容量計画ツール (CPT) を使用します。保護する VM のリストと、その RTO およびリカバリ グループの設定を指定して、CPT を実行します。

CPT は次の機能を実行します。

* RTO に応じて VM を保護ドメインに結合します。
* DRVA の最適な数とそのリソースを定義します。
* 必要なレプリケーション帯域幅を見積もります。
* レプリケーション ログ ボリュームの特性 (容量、帯域幅など) を識別します。
* 必要なオブジェクト ストレージ容量の見積もりなど。



NOTE: 規定されるドメインの数と内容は、平均 IOPS、合計容量、優先度 (フェイルオーバー順序を定義)、RTO などのさまざまな VM 特性によって異なります。



== オンプレミスデータセンターに JetStream DR をインストールする

JetStream DR ソフトウェアは、JetStream DR 管理サーバー仮想アプライアンス (MSA)、DR 仮想アプライアンス (DRVA)、およびホスト コンポーネント (I/O フィルター パッケージ) の 3 つの主要コンポーネントで構成されています。 MSA は、コンピューティング クラスターにホスト コンポーネントをインストールして構成し、JetStream DR ソフトウェアを管理するために使用されます。次のリストは、インストール プロセスの概要を示しています。

.オンプレミス向けJetStream DRのインストール方法
[%collapsible%open]
====
. 前提条件を確認してください。
. リソースと構成の推奨事項を取得するには、容量計画ツールを実行します (オプションですが、概念実証のトライアルには推奨されます)。
. 指定されたクラスタ内の vSphere ホストに JetStream DR MSA をデプロイします。
. ブラウザで DNS 名を使用して MSA を起動します。
. vCenter サーバーを MSA に登録します。インストールを実行するには、次の詳細な手順を実行します。
. JetStream DR MSA がデプロイされ、vCenter Server が登録されたら、vSphere Web Client を使用して JetStream DR プラグインにアクセスします。これは、[データセンター] > [構成] > [JetStream DR] に移動することで実行できます。
+
image:vmware-dr-008.png["入出力ダイアログまたは書かれたコンテンツを示す図"]

. JetStream DR インターフェースから適切なクラスターを選択します。
+
image:vmware-dr-009.png["入出力ダイアログまたは書かれたコンテンツを示す図"]

. I/O フィルター パッケージを使用してクラスターを構成します。
+
image:vmware-dr-010.png["入出力ダイアログまたは書かれたコンテンツを示す図"]

. リカバリ サイトにある Azure Blob Storage を追加します。
. アプライアンス タブから DR 仮想アプライアンス (DRVA) をデプロイします。



NOTE: DRVA は CPT によって自動的に作成できますが、POC トライアルの場合は DR サイクルを手動で構成して実行することをお勧めします (保護の開始 > フェールオーバー > フェールバック)。

JetStream DRVA は、データ複製プロセスの主要な機能を容易にする仮想アプライアンスです。保護されたクラスターには少なくとも 1 つの DRVA が含まれている必要があり、通常はホストごとに 1 つの DRVA が構成されます。各 DRVA は複数の保護されたドメインを管理できます。

image:vmware-dr-011.png["入出力ダイアログまたは書かれたコンテンツを示す図"]

この例では、80 台の仮想マシンに対して 4 つの DRVA が作成されました。

. 使用可能なデータストアまたは独立した共有 iSCSI ストレージ プールから VMDK を使用して、各 DRVA のレプリケーション ログ ボリュームを作成します。
. [保護されたドメイン] タブで、Azure Blob Storage サイト、DRVA インスタンス、レプリケーション ログに関する情報を使用して、必要な数の保護されたドメインを作成します。保護されたドメインは、一緒に保護され、フェイルオーバー/フェイルバック操作の優先順位が割り当てられている、クラスター内の特定の VM または VM セットを定義します。
+
image:vmware-dr-012.png["入出力ダイアログまたは書かれたコンテンツを示す図"]

. 保護する VM を選択し、保護されたドメインの VM 保護を開始します。これにより、指定された BLOB ストアへのデータのレプリケーションが開始されます。



NOTE: 保護されたドメイン内のすべての VM に同じ保護モードが使用されていることを確認します。


NOTE: ライトバック (VMDK) モードでは、より高いパフォーマンスを提供できます。

image:vmware-dr-013.png["入出力ダイアログまたは書かれたコンテンツを示す図"]

レプリケーション ログ ボリュームが高パフォーマンス ストレージに配置されていることを確認します。


NOTE: フェールオーバー実行ブックは、VM をグループ化 (リカバリ グループと呼ばれる) し、ブート順序シーケンスを設定し、CPU/メモリ設定と IP 構成を変更するように構成できます。

====


== 実行コマンドを使用して、Azure VMware Solution プライベート クラウドに JetStream DR for AVS をインストールする

リカバリ サイト (AVS) のベスト プラクティスは、3 ノードのパイロット ライト クラスターを事前に作成することです。これにより、次の項目を含むリカバリ サイトのインフラストラクチャを事前に構成できます。

* 宛先ネットワーク セグメント、ファイアウォール、DHCP や DNS などのサービスなど。
* AVS用JetStream DRのインストール
* ANF ボリュームをデータストアとして構成するなど、JetStream DR はミッションクリティカルなドメイン向けにほぼゼロの RTO モードをサポートします。これらのドメインでは、宛先ストレージが事前にインストールされている必要があります。この場合、ANF が推奨されるストレージ タイプです。



NOTE: セグメント作成を含むネットワーク構成は、オンプレミスの要件に合わせて AVS クラスター上で構成する必要があります。

SLA および RTO 要件に応じて、継続的なフェイルオーバーまたは通常の (標準) フェイルオーバー モードを使用できます。  RTO をほぼゼロにするには、リカバリサイトで継続的な再水和を開始する必要があります。

.プライベートクラウドに JetStream DR for AVS をインストールする方法
[%collapsible%open]
====
Azure VMware Solution プライベート クラウドに JetStream DR for AVS をインストールするには、次の手順を実行します。

. Azure ポータルから Azure VMware ソリューションに移動し、プライベート クラウドを選択して、[コマンドの実行] > [パッケージ] > [JSDR.Configuration] を選択します。
+

NOTE: Azure VMware Solution のデフォルトの CloudAdmin ユーザーには、JetStream DR for AVS をインストールするための十分な権限がありません。  Azure VMware Solution では、JetStream DR の Azure VMware Solution 実行コマンドを呼び出すことで、JetStream DR のインストールを簡素化および自動化できます。

+
次のスクリーンショットは、DHCP ベースの IP アドレスを使用したインストールを示しています。

+
image:vmware-dr-014.png["入出力ダイアログまたは書かれたコンテンツを示す図"]

. JetStream DR for AVS のインストールが完了したら、ブラウザを更新します。  JetStream DR UI にアクセスするには、[SDDC データセンター] > [構成] > [JetStream DR] に移動します。
+
image:vmware-dr-015.png["入出力ダイアログまたは書かれたコンテンツを示す図"]

. JetStream DR インターフェイスから、オンプレミス クラスターをストレージ サイトとして保護するために使用された Azure Blob Storage アカウントを追加し、スキャン ドメイン オプションを実行します。
+
image:vmware-dr-016.png["入出力ダイアログまたは書かれたコンテンツを示す図"]

. 保護されたドメインをインポートした後、DRVA アプライアンスを展開します。この例では、JetStream DR UI を使用してリカバリ サイトから継続的なリハイドレーションを手動で開始します。
+

NOTE: これらの手順は、CPT が作成したプランを使用して自動化することもできます。

. 利用可能な vSAN または ANF データストアを使用してレプリケーション ログ ボリュームを作成します。
. 保護されたドメインをインポートし、VM の配置に ANF データストアを使用するように Recovery VA を構成します。
+
image:vmware-dr-017.png["入出力ダイアログまたは書かれたコンテンツを示す図"]

+

NOTE: 選択したセグメントで DHCP が有効になっており、十分な IP が利用可能であることを確認します。ドメインが回復している間、動的 IP が一時的に使用されます。回復中の各 VM (継続的なリハイドレーションを含む) には個別の動的 IP が必要です。回復が完了すると、IP は解放され、再利用できるようになります。

. 適切なフェイルオーバー オプション (継続的なフェイルオーバーまたはフェイルオーバー) を選択します。この例では、継続的なリハイドレーション (継続的なフェイルオーバー) が選択されています。
+
image:vmware-dr-018.png["入出力ダイアログまたは書かれたコンテンツを示す図"]



====


== フェイルオーバー/フェイルバックの実行

.フェイルオーバー/フェイルバックを実行する方法
[%collapsible%open]
====
. オンプレミス環境の保護されたクラスターで災害 (部分的または完全な障害) が発生した後、フェイルオーバーをトリガーします。
+

NOTE: CPT を使用すると、フェールオーバー プランを実行して、Azure Blob Storage から AVS クラスター回復サイトに VM を回復できます。

+

NOTE: フェールオーバー後 (継続的または標準のリハイドレーション)、保護された VM が AVS で起動されると、保護は自動的に再開され、JetStream DR は引き続きデータを Azure Blob Storage 内の適切な元のコンテナーに複製します。

+
image:vmware-dr-019.png["入出力ダイアログまたは書かれたコンテンツを示す図"]

+
image:vmware-dr-020.png["入出力ダイアログまたは書かれたコンテンツを示す図"]

+
タスク バーには、フェールオーバー アクティビティの進行状況が表示されます。

. タスクが完了したら、回復した VM にアクセスし、業務を通常どおり継続します。
+
image:vmware-dr-021.png["入出力ダイアログまたは書かれたコンテンツを示す図"]

+
プライマリ サイトが再び稼働したら、フェイルバックを実行できます。  VM 保護が再開され、データの一貫性がチェックされる必要があります。

. オンプレミス環境を復元します。災害インシデントの種類によっては、保護されたクラスターの構成を復元および/または検証する必要がある場合があります。必要に応じて、JetStream DR ソフトウェアを再インストールする必要があります。
+

NOTE: 注: `recovery_utility_prepare_failback` Automation Toolkit で提供されるスクリプトを使用すると、元の保護されたサイトから古い VM、ドメイン情報などを削除できます。

. 復元されたオンプレミス環境にアクセスし、Jetstream DR UI に移動して、適切な保護されたドメインを選択します。保護されたサイトのフェイルバックの準備ができたら、UI でフェイルバック オプションを選択します。
+
image:vmware-dr-022.png["入出力ダイアログまたは書かれたコンテンツを示す図"]




NOTE: CPT によって生成されたフェイルバック プランは、VM とそのデータをオブジェクト ストアから元の VMware 環境に戻す作業を開始するためにも使用できます。


NOTE: リカバリ サイトで VM を一時停止し、保護サイトで再起動した後の最大遅延を指定します。この時間には、フェールオーバー VM を停止した後のレプリケーションの完了、リカバリ サイトのクリーンアップにかかる時間、保護されたサイトで VM を再作成する時間が含まれます。  NetApp の推奨値は 10 分です。

フェイルバック プロセスを完了し、VM 保護とデータの整合性の再開を確認します。

====


== ランサムウェアの回復

ランサムウェアからの回復は困難な作業になる可能性があります。具体的には、IT 組織にとって、安全な復帰ポイントを決定すること、また、決定した後で、回復したワークロードが再発する攻撃（休眠中のマルウェアや脆弱なアプリケーションによる攻撃）から確実に保護されるようにする方法を決定することが困難になることがあります。

JetStream DR for AVS をAzure NetApp Filesデータストアと組み合わせると、組織が利用可能な時点から回復できるようにすることでこれらの懸念に対処でき、必要に応じてワークロードを機能する分離されたネットワークに回復できます。リカバリにより、アプリケーションは North-South トラフィックに公開されることなく機能し、相互に通信できるようになるため、セキュリティ チームはフォレンジックやその他の必要な修復を安全に実行できるようになります。

image:vmware-dr-023.png["入出力ダイアログまたは書かれたコンテンツを示す図"]
