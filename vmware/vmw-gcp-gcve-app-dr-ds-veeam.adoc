---
sidebar: sidebar 
permalink: vmware/vmw-gcp-gcve-app-dr-ds-veeam.html 
keywords: gcp, gcve, snapcenter, cvo, gcnv, iscsi, guest connect, dr, disaster recovery 
summary: クラウドへの災害復旧は、サイトの停止やランサムウェアなどのデータ破損イベントからワークロードを保護する、回復力がありコスト効率に優れた方法です。  NetApp SnapMirror を使用すると、ゲスト接続ストレージを使用するオンプレミスの VMware ワークロードを、Google Cloud で実行されているNetApp Cloud Volumes ONTAPに複製できます。 
---
= NetApp SnapCenterと Veeam レプリケーションによるアプリケーション整合性のある災害復旧
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
クラウドへの災害復旧は、サイトの停止やランサムウェアなどのデータ破損イベントからワークロードを保護する、回復力がありコスト効率に優れた方法です。  NetApp SnapMirror を使用すると、ゲスト接続ストレージを使用するオンプレミスの VMware ワークロードを、Google Cloud で実行されているNetApp Cloud Volumes ONTAPに複製できます。



== 概要

多くのお客様は、VMware vSphere でホストされているアプリケーション VM 向けの効果的な災害復旧ソリューションを求めています。災害時の復旧には、既存のバックアップ ソリューションを使用する企業が多くあります。多くの場合、このソリューションは RTO を増加させ、顧客の期待を満たしません。 RPO と RTO を削減するために、ネットワーク接続と適切な権限を持つ環境が利用可能であれば、オンプレミスから GCVE まで Veeam VM レプリケーションを利用できます。注意: Veeam VM レプリケーションは、ゲスト VM 内の iSCSI や NFS マウントなどの VM ゲスト接続ストレージ デバイスを保護しません。これらを別々に保護する必要があります。

SQL VM のアプリケーション整合性のあるレプリケーションと RTO の削減を実現するために、 SnapCenterを使用して SQL データベースとログ ボリュームの snapmirror 操作を調整しました。

このドキュメントでは、 NetApp SnapMirror、Veeam、Google Cloud VMware Engine（GCVE）を使用した災害復旧の設定と実行の手順を詳しく説明します。

image:dr-cvs-gcve-veeam-001.png["アプリケーションVMレプリケーションアーキテクチャ"]



== 前提

このドキュメントでは、アプリケーション データ用のゲスト内ストレージ (ゲスト接続とも呼ばれます) に焦点を当てており、オンプレミス環境でアプリケーション整合性のあるバックアップにSnapCenterを使用していることを前提としています。


NOTE: このドキュメントは、サードパーティのバックアップまたはリカバリ ソリューションに適用されます。環境で使用されているソリューションに応じて、ベスト プラクティスに従って、組織の SLA を満たすバックアップ ポリシーを作成します。

オンプレミス環境と Google Cloud ネットワーク間の接続には、専用相互接続や Cloud VPN などの接続オプションを使用します。セグメントは、オンプレミスの VLAN 設計に基づいて作成する必要があります。


NOTE: オンプレミスのデータセンターを Google Cloud に接続するには複数のオプションがあるため、このドキュメントでは具体的なワークフローを説明することはできません。オンプレミスから Google への適切な接続方法については、Google Cloud のドキュメントを参照してください。



== DRソリューションの導入



=== ソリューション展開の概要

. 必要な RPO 要件に従って、 SnapCenterを使用してアプリケーション データがバックアップされていることを確認します。
. 適切なサブスクリプションと仮想ネットワーク内でBlueXPを使用して、正しいインスタンス サイズでCloud Volumes ONTAP をプロビジョニングします。
+
.. 関連するアプリケーション ボリュームに対してSnapMirrorを構成します。
.. スケジュールされたジョブの後にSnapMirror の更新をトリガーするように、 SnapCenterのバックアップ ポリシーを更新します。


. Veeam ソフトウェアをインストールし、Google Cloud VMware Engine インスタンスへの仮想マシンのレプリケーションを開始します。
. 災害発生時には、 BlueXPを使用してSnapMirror関係を解除し、Veeam を使用して仮想マシンのフェイルオーバーをトリガーします。
+
.. アプリケーション VM の ISCSI LUN と NFS マウントを再接続します。
.. アプリケーションをオンラインで起動します。


. プライマリ サイトが回復された後、 SnapMirror を逆再同期して、保護されたサイトへのフェイルバックを呼び出します。




=== 導入環境の詳細

.Google Cloud で CVO を構成し、ボリュームを CVO に複製する
[%collapsible%open]
====
最初のステップは、Google Cloud でCloud Volumes ONTAP を構成することです (link:vmw-gcp-gcve-guest-storage.html["最高経営責任者"^] ）を作成し、必要な頻度とスナップショット保持期間で、必要なボリュームをCloud Volumes ONTAPに複製します。

image:dr-cvo-gcve-002.png["入出力ダイアログまたは書かれたコンテンツを示す図"]

SnapCenterの設定とデータの複製に関するサンプルの手順については、以下を参照してください。link:vmw-aws-vmc-guest-storage-dr.html#config-snapmirror["SnapCenterでレプリケーションを設定する"]

.SnapCenterによる SQL VM 保護のレビュー
video::395e33db-0d63-4e48-8898-b01200f006ca[panopto]
====
.GCVEホストとCVOデータアクセスを構成する
[%collapsible%open]
====
SDDC を展開する際に考慮すべき 2 つの重要な要素は、GCVE ソリューション内の SDDC クラスターのサイズと、SDDC をサービスに維持する期間です。災害復旧ソリューションに関するこれら 2 つの重要な考慮事項は、全体的な運用コストの削減に役立ちます。  SDDC は、最小 3 台のホストから、本格的な展開のマルチホスト クラスターまで、さまざまな規模にすることができます。

Google Cloud NetApp Volumes for NFS データストアとCloud Volumes ONTAP for SQL データベースおよびログは任意の VPC にデプロイできますが、GCVE は NFS データストアをマウントし、VM を iSCSI LUN に接続するためにその VPC へのプライベート接続が必要です。

GCVE SDDCを構成するには、以下を参照してください。link:vmw-gcp-gcve-setup.html["Google Cloud Platform (GCP) に仮想化環境をデプロイして構成する"^] 。前提条件として、接続が確立された後、GCVE ホスト上にあるゲスト VM がCloud Volumes ONTAPからデータを使用できることを確認します。

Cloud Volumes ONTAPと GCVE が適切に構成されたら、Veeam レプリケーション機能を使用し、アプリケーション ボリュームのコピーにSnapMirrorを活用して、オンプレミスのCloud Volumes ONTAPの GCVE (アプリケーション VMDK を持つ VM とゲスト内ストレージを持つ VM) へのリカバリを自動化するように Veeam の構成を開始します。

====
.Veeamコンポーネントをインストールする
[%collapsible%open]
====
展開シナリオに基づいて、展開する必要がある Veeam バックアップ サーバー、バックアップ リポジトリ、およびバックアップ プロキシ。このユースケースでは、Veeam のオブジェクト ストアを展開する必要はなく、スケールアウト リポジトリも必要ありません。https://helpcenter.veeam.com/docs/backup/vsphere/replication_components.html?ver=120["インストール手順については、Veeamのドキュメントを参照してください。"]詳細については、link:vmw-gcp-gcve-migrate-veeam.html["Veeam Replicationによる移行"]

====
.Veeam で VM レプリケーションを設定する
[%collapsible%open]
====
オンプレミスの vCenter と GCVE vCenter の両方を Veeam に登録する必要があります。 https://helpcenter.veeam.com/docs/backup/vsphere/replica_job.html?ver=120["vSphere VM レプリケーションジョブのセットアップ"]ウィザードのゲスト処理手順では、アプリケーション対応のバックアップとリカバリにSnapCenterを利用するため、アプリケーション処理を無効にすることを選択します。

video::8b7e4a9b-7de1-4d48-a8e2-b01200f00692[panopto,width=360]
====
.Microsoft SQL Server VM のフェイルオーバー
[%collapsible%open]
====
video::9762dc99-081b-41a2-ac68-b01200f00ac0[panopto,width=360]
====


== このソリューションの利点

* SnapMirrorの効率的で復元力のあるレプリケーションを使用します。
* ONTAPスナップショット保持を使用して、利用可能な任意の時点に回復します。
* ストレージ、コンピューティング、ネットワーク、アプリケーションの検証手順から、数百から数千の VM を復旧するために必要なすべての手順を完全に自動化できます。
* SnapCenter は、複製されたボリュームを変更しないクローン作成メカニズムを使用します。
+
** これにより、ボリュームとスナップショットのデータ破損のリスクを回避できます。
** DR テスト ワークフロー中のレプリケーションの中断を回避します。
** 開発/テスト、セキュリティ テスト、パッチおよびアップグレード テスト、修復テストなど、DR 以外のワークフローに DR データを活用します。


* Veeam Replication では、DR サイト上の VM IP アドレスを変更できます。

