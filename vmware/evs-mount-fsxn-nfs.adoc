---
sidebar: sidebar 
permalink: vmware/evs-mount-fsxn-nfs.html 
keywords: Amazon, AWS, EVS, Elastic VMware Service, ONTAP, FSx, nfs 
summary: このセクションでは、FSx for ONTAP をNFS データストアとして導入する手順を説明します。  iSCSI データストアを展開する手順については、次のセクションで詳しく説明します。 
---
= FSx for ONTAP をNFS データストアとして使用するための導入手順
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
このセクションでは、FSx for ONTAP をNFS データストアとして導入する手順を説明します。  iSCSI データストアを展開する手順については、次のセクションで詳しく説明します。



== 大まかな展開手順

Amazon EVS の NFS データストアとして使用するために FSx for ONTAPファイルシステムをデプロイし、2 つのサービス間の接続を確立するには、次の手順を実行します。

* Amazon EVS VCF 環境が配置されているのと同じ VPC に FSx for ONTAPファイルシステムをセットアップします。
* セキュリティ グループとルーティング テーブルを検証しています。
* Amazon EVS の NFS データストアとして使用するために FSx for ONTAPストレージボリュームを接続します。




== 前提条件

FSx for ONTAP をAmazon EVS の NFS データストアとしてセットアップするプロセスを開始する前に、次の前提条件を満たしている必要があります。

* Amazon EVS 仮想化環境。詳細については、次のドキュメントを参照してください。link:https://docs.aws.amazon.com/evs/latest/userguide/what-is-evs.html["Amazon EVS 入門ガイド"] 。
* 適切な SSD ストレージ容量、プロビジョニングされた IOPS およびスループットを備えた、 ONTAP用のシングル アベイラビリティ ゾーン (AZ) FSx を作成します。
* 最適なパフォーマンスを得るには、FSx for ONTAPファイルシステムを Amazon EVS インスタンスと同じ VPC 内に配置します。  FSx for ONTAPが別の VPC にデプロイされている場合にも、VPC ピアリングがサポートされることに注意してください。
* パフォーマンス要件に基づいて、Single-AZ FSx for ONTAPファイル システムに必要な適切な IOPS とスループットを選択します。見るlink:https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/performance.html["FSx for ONTAPのパフォーマンス仕様の詳細"]利用可能な各オプションが提供するスループットと IOPS を理解します。



NOTE: このガイドでは、FSx for ONTAPファイル システムをサービス アクセス サブネットと同じサブネットにデプロイします。

Amazon EVS 仮想化環境が VPC にデプロイされたら、NFS データストアとして使用される Single-AZ FSx for ONTAPファイルシステムのセットアップに進むことができます。


NOTE: FSx for ONTAPファイルシステムは、Amazon EVS SDDC と同じ AZ にデプロイする必要があります。



== FSx for ONTAPファイルシステムを作成する

次の手順では、FSx for ONTAPファイル システムをプロビジョニングおよびマウントする方法を示します。

. Amazon FSxコンソールへアクセスしてください `https://console.aws.amazon.com/fsx/`インターネット ブラウザを使用して、資格情報でサインインします。
. コンソールで、「ファイル システムの作成」を選択します。これにより、FSx for ONTAPファイル システムを作成するためのセットアップ ウィザードが開始されます。
. まず、ファイルシステムの種類を選択します。利用可能なファイルシステムオプションから「Amazon FSx for NetApp ONTAP」を選択し、「次へ」ボタンをクリックして続行します。
+
image:evs-mount-fsxn-002.png["ファイルシステムの種類を選択するダイアログを表す図"]

. クイック作成オプションと標準作成オプションのどちらかを選択できます。クイック作成では事前定義された構成が提供され、標準作成では独自の構成を定義できます。
+
「標準作成」オプションを選択します。

+
image:evs-mount-fsxn-003.png["ファイルシステムの種類の選択、標準の作成ダイアログを表す図"]

+
これで、標準のファイル システム作成セットアップ ウィザードが起動します。ファイル システムの詳細ページで、次の画像に示すのと同じ情報を選択して入力します。

+
image:evs-mount-fsxn-004.png["ファイルシステムタイプの選択、標準作成ウィザードを表す図"]

. 「ネットワークとセキュリティ」というセクションまで下にスクロールします。このセクションでは、サブネットと VPC の詳細を設定します。このガイドでは、ドロップダウン メニューから「EVS-VPC」を選択し、EVS 仮想環境のサブネットとしてサービス アクセス サブネット (タグなし VLAN) を選択しました。
+

NOTE: サブネットは、VPC 内のタグなしのプライベート サブネットにすることができます。適切なルーティングが設定されている限り、VPC ピアリング経由で接続された別の VPC/サブネットに配置することもできます。

+
image:evs-mount-fsxn-005.png["ネットワークセキュリティダイアログを表す図"]

. 下にスクロールすると、「セキュリティと暗号化」セクションがあります。ここで、ドロップダウン メニューから暗号化キーを選択します。これらのキーは AWS Key Management Service (AWS KMS) によって提供され、FSx for ONTAPファイルシステム内の保存データを保護します。
+
次に、「ファイルシステム管理パスワード」設定で、ファイルシステムを管理する fsxadmin ユーザーの一意のパスワードを指定します。

+
image:evs-mount-fsxn-006.png["セキュリティと暗号化のダイアログを表す図"]

. 次に、「デフォルトのストレージ仮想マシン構成」というセクションまで下にスクロールします。ここで、ストレージ仮想マシン (SVM) の名前を指定する必要があります。
+
image:evs-mount-fsxn-007.png["デフォルトのストレージ仮想マシン構成ダイアログを表す図"]

. 次に、「デフォルトのボリューム構成」というセクションまで下にスクロールします。ここでボリュームの名前を指定し、ボリューム サイズを設定します。ボリューム プロトコルは NFS v3 (デフォルトで有効) である必要があります。オプションをクリックして、ストレージ効率機能 (圧縮、重複排除、圧縮) を有効にし、全体的なストレージ使用量とコストを削減します。
+
image:evs-mount-fsxn-008.png["デフォルトのボリューム設定ダイアログを表す図"]

. ストレージ階層化オプションでは、ドロップダウン メニューから「スナップショットのみ」を選択し、階層化ポリシーの冷却期間を設定します。デフォルトは 31 日ですが、この例では 2 日間の冷却期間を設定します。
+
image:evs-mount-fsxn-009.png["ストレージ階層化ダイアログを表す図"]

. ボリュームを作成したら、 ONTAPコマンドライン インターフェイス (ONTAP CLI) を使用して次のパラメータを変更します。
+
[cols="50%, 50%"]
|===
| *設定* | *構成* 


| ボリューム ギャランティ | なし（シンプロビジョニング） 


| fractional_reserve | 0% 


| snap_reserve | 0% 


| 自動サイズ調整 | grow_shrink 


| ストレージ効率 | 有効 


| ボリューム階層化ポリシー | Snapshot のみ 


| アクセス時刻の更新 (-atime-update) | 間違い 


| 最小先読み (-min-readahead) | 間違い 


| スナップショットポリシー | なし 
|===
. オプションの「バックアップとメンテナンス」手順で、毎日の自動バックアップを無効にし、毎週のメンテナンス ウィンドウに「優先なし」を選択します。
+
完了したら「次へ」をクリックします。

+
image:evs-mount-fsxn-010.png["ファイルシステム作成ダイアログの完了を表す図"]

. 前の手順に従って設定したファイル システム構成全体の確認が行われます。すべてのパラメータが正しいことを確認し、「ファイルシステムの作成」ボタンをクリックしてセットアップを完了します。
+
image:evs-mount-fsxn-011.png["ファイルシステム作成ダイアログを表す図"]

+
image:evs-mount-fsxn-012.png["ファイルシステム作成ダイアログを表す図"]

+

NOTE: 追加の FSx for ONTAPファイル システムを作成するには、上記の手順に従い、必要に応じてパフォーマンスとディスク容量に影響する値を調整します。  FSx for ONTAPのパフォーマンスオプションの詳細については、以下を参照してください。link:https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/performance.html["このドキュメントページ"] 。





== VPC および仮想化環境のルーティングとセキュリティ グループの検証

VPC および SDDC のルーティングとセキュリティ グループを検証することは、Amazon EVS 仮想化環境と FSx for ONTAPファイルシステム コンポーネントが適切に連携できることを確認するために重要です。

. Elastic VMware サービス > 仮想化環境 > [Amazon EVS 環境] を参照し、以下の緑色の矢印で示されているように、サービス アクセス サブネットを選択します。
+
image:evs-mount-fsxn-013.png["上記の手順のダイアログを表す図"]

. サブネット パネルが開きます。このパネルでルート テーブルを見つけてクリックします。
+
この例では、FSxN ONTAPファイルシステムは Amazon EVS VCF 環境と同じ VPC 内にあるため、デフォルトのルートで十分です。

+
image:evs-mount-fsxn-014.png["上記の手順のダイアログを表す図"]

+
FSx for ONTAPファイル システムが別の VPC にある場合は、その VPC へのルートが追加されていることを確認します。この例では、FSx for ONTAPシステムが存在する VPC への VPC ピアリングのルートが追加されています。

+
image:evs-mount-fsxn-015.png["上記の手順のダイアログを表す図"]

. 次に、FSx for ONTAPファイル システムに接続されているセキュリティ グループ (つまり、Elastic Network Interface (ENI) に接続されているセキュリティ グループ) が NFS ポートへのアクセスを許可していることを確認する必要があります。
+
NFSおよびiSCSIプロトコルポートの完全なリストについては、リンクhttps://docs.aws.amazon.com/fsx/latest/ONTAPGuide/limit-access-security-groups.html]Amazon VPCを使用したファイルシステムアクセスコントロールのドキュメントを参照してください。

+
FSx for ONTAPファイル システムがセキュリティ グループに関連付けられていることを確認するには、次の手順を実行します。

+
.. AWS コンソールで、[FSx] > [ファイルシステム] > [FSx for ONTAPファイルシステム] に移動します。
.. [ネットワークとセキュリティ] タブで、ENI をクリックします。
.. ネットワーク インターフェイスの詳細の下にリストされている、ENI に関連付けられたセキュリティ グループを見つけます (下の画像では緑色の矢印で示されています)。
+
image:evs-mount-fsxn-016.png["上記の手順のダイアログを表す図"]

.. ポートを検証します。次の画面に示す例では、すべてのトラフィックが許可されています。ただし、これらを NFS ポートのみに制限することもできます。ポートのリストは次のとおりです。
+
*** ポート 111 TCP: ポートマッパー。NFS 要求で使用されるポートをネゴシエートするために使用されます。
*** ポート 635 TCP: 着信マウント要求を受信するための Mountd。
*** ポート 2049 TCP: NFS。NFS トラフィックを処理します。
*** ポート 4045 TCP: ロック要求を処理するネットワーク ロック マネージャー (NLM)。
*** ポート 4046 TCP: ネットワーク ステータス モニター (NSM)。サーバーがロック管理のために再起動すると、NFS クライアントに通知を送信します。
+
image:evs-mount-fsxn-017.png["上記の手順のダイアログを表す図"]









== FSx for ONTAP NFS ボリュームを Amazon EVS に接続してデータストアとして使用する

FSx for ONTAPファイルシステムがプロビジョニングされ、適切な接続パラメータがすべて検証されたので、次は FSx for ONTAPストレージボリュームを Amazon EVS に接続します。次の手順では、vCenter にアクセスし、FSx for ONTAPボリュームを NFS データストアとしてマウントする方法を示します。

. vSphere クライアントで、「データストア」タブに移動します。以下に示すように、データセンターを見つけて、[ストレージ] > [新しいデータストア] に移動します。
+
image:evs-mount-fsxn-018.png["上記の手順のダイアログを表す図"]

. 新しいデータストア ウィザードが起動します。  「タイプ」ステップでは、データストアのタイプを選択します。  「NFS」を選択し、「次へ」をクリックして続行します。
+
image:evs-mount-fsxn-019.png["上記の手順のダイアログを表す図"]

. 「NFS バージョン」の手順では、NFS バージョンを選択します。
+
この例では、「NFS 3」を選択しますが、NFS v4.1 も使用できることに注意してください。

+
image:evs-mount-fsxn-020.png["上記の手順のダイアログを表す図"]

. 「名前と構成」の手順では、次の操作を行います。
+
.. データストアに名前を付けます。
.. フォルダに名前を付けます。  NFS ボリュームへのジャンクション パスを使用します。
.. サーバーに名前を付けます。  SVM の NFS DNS 名または NFS の IP アドレスのいずれかを使用します。
+
「次へ」をクリックして続行します。

+
image:evs-mount-fsxn-021.png["上記の手順のダイアログを表す図"]



. 「ホスト アクセシビリティ」の手順で、データストアへのアクセスを必要とするすべてのホストを選択し、「次へ」をクリックして続行します。
+
image:evs-mount-fsxn-022.png["上記の手順のダイアログを表す図"]

. 「完了準備完了」のステップでデータを確認し、「完了」をクリックしてセットアップを完了します。
+
image:evs-mount-fsxn-023.png["上記の手順のダイアログを表す図"]

. 以下に示すように、vCenter にアクセスして NFS データストアが接続されていることを確認します。
+
image:evs-mount-fsxn-024.png["上記の手順のダイアログを表す図"]


