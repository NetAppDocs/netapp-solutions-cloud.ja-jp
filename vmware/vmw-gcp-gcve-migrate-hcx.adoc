---
sidebar: sidebar 
permalink: vmware/vmw-gcp-gcve-migrate-hcx.html 
keywords: gcp, gcve, hybrid, multicloud, migrate, vmware, hcx, google, cloud, enterprise, hybrid, cloud, migration 
summary:  
---
= VMware HCX を使用して Google Cloud VMware Engine 上の Google Cloud Google Cloud NetApp Volumesデータストアにワークロードを移行する - クイックスタート ガイド
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Google Cloud VMware Engine と Cloud Volume Service データストアの最も一般的な使用例の 1 つは、VMware ワークロードの移行です。  VMware HCX は推奨されるオプションであり、オンプレミスの仮想マシン (VM) とそのデータを Cloud Volume Service NFS データストアに移動するためのさまざまな移行メカニズムを提供します。



== 概要: VMware HCX、 Google Cloud NetApp Volumesデータストア、Google Cloud VMware Engine（GCVE）を使用した仮想マシンの移行

VMware HCX は主に、アプリケーションの移行、ワークロードの再調整、さらにはクラウド間のビジネス継続性を簡素化するように設計された移行プラットフォームです。これは Google Cloud VMware Engine プライベート クラウドの一部として含まれており、ワークロードを移行するためのさまざまな方法を提供し、災害復旧 (DR) オペレーションに使用できます。

このドキュメントでは、Cloud Volume Service データストアをプロビジョニングし、その後、オンプレミスと Google Cloud VMware Engine 側のすべての主要コンポーネント（相互接続、ネットワーク拡張、さまざまな VM 移行メカニズムを有効にするための WAN 最適化など）を含む VMware HCX をダウンロード、デプロイ、構成するための手順を詳しく説明します。


NOTE: VMware HCX は、移行が VM レベルで行われるため、どのデータストア タイプでも動作します。したがって、このドキュメントは、コスト効率の高い VMware クラウドの導入のために Google Cloud VMware Engine を使用して Cloud Volume Service を導入することを計画している既存のNetApp のお客様と非NetApp のお客様に適用されます。

.大まかな手順
[%collapsible%open]
====
このリストには、オンプレミスの HCX コネクタから Google Cloud VMware Engine 側の HCX Cloud Manager に VM をペアリングして移行するために必要な手順の概要が示されています。

. Google VMware Engine ポータルを通じて HCX を準備します。
. オンプレミスの VMware vCenter Server に HCX コネクタ Open Virtualization Appliance (OVA) インストーラーをダウンロードしてデプロイします。
. ライセンス キーを使用して HCX をアクティブ化します。
. オンプレミスの VMware HCX コネクタと Google Cloud VMware Engine HCX Cloud Manager をペアリングします。
. ネットワーク プロファイル、コンピューティング プロファイル、およびサービス メッシュを構成します。
. (オプション) 移行中に IP の再割り当てを避けるためにネットワーク拡張を実行します。
. アプライアンスのステータスを検証し、移行が可能であることを確認します。
. VM ワークロードを移行します。


====
.前提条件
[%collapsible%open]
====
始める前に、次の前提条件が満たされていることを確認してください。詳細については、こちらをご覧ください https://cloud.google.com/vmware-engine/docs/workloads/howto-migrate-vms-using-hcx["リンク"^]。接続などの前提条件が整ったら、Google Cloud VMware Engine ポータルから HCX ライセンス キーをダウンロードします。  OVA インストーラをダウンロードしたら、以下の説明に従ってインストール プロセスを続行します。


NOTE: HCX アドバンスドはデフォルトのオプションであり、VMware HCX エンタープライズ エディションもサポート チケットを通じて利用可能で、追加費用なしでサポートされます。参照する https://cloud.google.com/blog/products/compute/whats-new-with-google-cloud-vmware-engine["このリンク"^]

* 既存のGoogle Cloud VMware Engineソフトウェア定義データセンター（SDDC）を使用するか、これを使用してプライベートクラウドを作成します。link:vmw-gcp-gcve-setup.html["NetAppリンク"^]またはこれ https://cloud.google.com/vmware-engine/docs/create-private-cloud["Googleリンク"^]。
* オンプレミスの VMware vSphere 対応データセンターから VM と関連データを移行するには、データセンターから SDDC 環境へのネットワーク接続が必要です。ワークロードを移行する前に、 https://cloud.google.com/vmware-engine/docs/networking/howto-connect-to-onpremises["Cloud VPN または Cloud Interconnect 接続を設定する"^]オンプレミス環境とそれぞれのプライベート クラウド間。
* オンプレミスの VMware vCenter Server 環境から Google Cloud VMware Engine プライベート クラウドへのネットワーク パスは、vMotion を使用した VM の移行をサポートしている必要があります。
* 必要な https://ports.esp.vmware.com/home/VMware-HCX["ファイアウォールルールとポート"^]オンプレミスの vCenter Server と SDDC vCenter 間の vMotion トラフィックが許可されます。
* Cloud Volume Service NFS ボリュームは、Google Cloud VMware Engine にデータストアとしてマウントする必要があります。この手順に従ってください https://cloud.google.com/vmware-engine/docs/vmware-ecosystem/howto-cloud-volumes-service-datastores["リンク"^]Cloud Volume Service データストアを Google Cloud VMware Engines ホストに接続します。


====
.高レベルアーキテクチャ
[%collapsible%open]
====
テストの目的で、この検証に使用されたオンプレミスのラボ環境は、オンプレミスから Google Cloud VPC への接続を可能にする Cloud VPN を介して接続されました。

image:gcpd-hcx-001.png["この画像は、このソリューションで使用される高レベルのアーキテクチャを示しています。"]

GoogleでのVMware HCXの使用に関する詳細については、以下を参照してください。 https://cloud.google.com/vmware-engine/docs/workloads/howto-migrate-vms-using-hcx["VMware リンク"^]

====


== ソリューションの展開

このソリューションの展開を完了するには、次の一連の手順に従います。

.ステップ 1: Google VMware Engine ポータルで HCX を準備する
[%collapsible%open]
====
VMware Engine を使用してプライベート クラウドをプロビジョニングすると、HCX Cloud Manager コンポーネントが自動的にインストールされます。サイトのペアリングを準備するには、次の手順を実行します。

. Google VMware Engine ポータルにログインし、HCX Cloud Manager にサインインします。
+
HCXバージョンリンクをクリックしてHCXコンソールにログインすることができます。image:gcpd-hcx-002.png["GCVE リソースへのリンクを使用した HCX コンソール アクセス"]または、vSphere Management Network タブの HCX FQDN をクリックします。image:gcpd-hcx-003.png["FQDN リンクによる HCX コンソール アクセス"]

. HCX Cloud Manager で、*管理 > システム アップデート* に移動します。
. *ダウンロードリンクをリクエスト* をクリックして、OVA ファイルをダウンロードします。image:gcpd-hcx-004.png["ダウンロードリンクをリクエスト"]
. HCX Cloud Manager を HCX Cloud Manager UI から入手可能な最新バージョンに更新します。


====
.ステップ2: オンプレミスのvCenter ServerにインストーラOVAを展開する
[%collapsible%open]
====
オンプレミス コネクタを Google Cloud VMware Engine の HCX マネージャーに接続するには、オンプレミス環境で適切なファイアウォール ポートが開いていることを確認してください。

オンプレミスの vCenter Server に HCX コネクタをダウンロードしてインストールするには、次の手順を実行します。

. 前の手順で説明したように、Google Cloud VMware Engine の HCX コンソールから ova をダウンロードします。
. OVA をダウンロードしたら、[OVF テンプレートのデプロイ] オプションを使用して、オンプレミスの VMware vSphere 環境にデプロイします。
+
image:gcpd-hcx-005.png["正しい OVA テンプレートを選択するためのスクリーンショット。"]

. OVA 展開に必要なすべての情報を入力し、[次へ] をクリックしてから [完了] をクリックして VMware HCX コネクタ OVA を展開します。
+

NOTE: 仮想アプライアンスを手動で電源オンします。



詳しい手順については、 https://cloud.google.com/vmware-engine/docs/workloads/howto-migrate-vms-using-hcx#prepare-for-hcx-manager-installation["Google HCX ドキュメント"^] 。

====
.ステップ3: ライセンスキーを使用してHCXコネクタをアクティブ化する
[%collapsible%open]
====
VMware HCX コネクタ OVA をオンプレミスにデプロイし、アプライアンスを起動したら、次の手順を実行して HCX コネクタをアクティブ化します。  Google Cloud VMware Engine ポータルからライセンス キーを生成し、VMware HCX Manager でアクティブ化します。

. VMware Engine ポータルから、[リソース] をクリックし、プライベート クラウドを選択して、*HCX Manager Cloud Version の下のダウンロード アイコンをクリックします*。image:gcpd-hcx-006.png["HCXライセンスをダウンロード"]ダウンロードしたファイルを開き、ライセンス キー文字列をコピーします。
. オンプレミスのVMware HCX Managerにログインします。 `"https://hcxmanagerIP:9443"`管理者の資格情報を使用します。
+

NOTE: OVA 展開中に定義された hcxmanagerIP とパスワードを使用します。

. ライセンスで、手順 3 でコピーしたキーを入力し、[アクティブ化] をクリックします。
+

NOTE: オンプレミスの HCX コネクタにはインターネット アクセスが必要です。

. *データセンターの場所* で、オンプレミスの VMware HCX Manager をインストールするための最も近い場所を指定します。  *続行*をクリックします。
. *システム名*の下で名前を更新し、*続行*をクリックします。
. *はい、続行*をクリックします。
. *vCenter への接続* で、vCenter Server の完全修飾ドメイン名 (FQDN) または IP アドレスと適切な資格情報を入力し、*続行* をクリックします。
+

NOTE: 後で接続の問題を回避するには、FQDN を使用します。

. *SSO/PSC の構成* で、Platform Services Controller (PSC) の FQDN または IP アドレスを入力し、*続行* をクリックします。
+

NOTE: 組み込み PSC の場合は、VMware vCenter Server の FQDN または IP アドレスを入力します。

. 入力した情報が正しいことを確認して、[再起動] をクリックします。
. サービスが再起動すると、表示されるページで vCenter Server が緑色で表示されます。  vCenter Server と SSO の両方に適切な構成パラメータが設定されている必要があります。これは前のページと同じである必要があります。
+

NOTE: このプロセスには、プラグインが vCenter Server に追加されるまでに約 10 ～ 20 分かかります。

+
image:gcpd-hcx-007.png["完了したプロセスを示すスクリーンショット。"]



====
.ステップ 4: オンプレミスの VMware HCX コネクタと Google Cloud VMware Engine HCX Cloud Manager をペアリングする
[%collapsible%open]
====
HCX コネクタをオンプレミスの vCenter にデプロイして構成したら、ペアリングを追加して Cloud Manager への接続を確立します。サイトのペアリングを構成するには、次の手順を実行します。

. オンプレミスの vCenter 環境と Google Cloud VMware Engine SDDC の間にサイト ペアを作成するには、オンプレミスの vCenter Server にログインし、新しい HCX vSphere Web Client プラグインにアクセスします。
+
image:gcpd-hcx-008.png["HCX vSphere Web Client プラグインのスクリーンショット。"]

. インフラストラクチャの下で、[*サイトペアリングを追加*]をクリックします。
+

NOTE: Google Cloud VMware Engine HCX Cloud Manager の URL または IP アドレスと、プライベート クラウドにアクセスするための Cloud-Owner-Role 権限を持つユーザーの認証情報を入力します。

+
image:gcpd-hcx-009.png["CloudOwner ロールのスクリーンショット URL または IP アドレスと資格情報。"]

. *接続*をクリックします。
+

NOTE: VMware HCX コネクタは、ポート 443 経由で HCX Cloud Manager IP にルーティングできる必要があります。

. ペアリングが作成されると、新しく構成されたサイト ペアリングが HCX ダッシュボードで利用できるようになります。
+
image:gcpd-hcx-010.png["HCX ダッシュボード上の完了したプロセスのスクリーンショット。"]



====
.ステップ5: ネットワークプロファイル、コンピューティングプロファイル、サービスメッシュを構成する
[%collapsible%open]
====
VMware HCX Interconnect サービス アプライアンスは、インターネット経由およびターゲット サイトへのプライベート接続を介したレプリケーションおよび vMotion ベースの移行機能を提供します。相互接続は、暗号化、トラフィック エンジニアリング、VM モビリティを提供します。  Interconnect サービス アプライアンスを作成するには、次の手順を実行します。

. [インフラストラクチャ] で、*[相互接続] > [マルチサイト サービス メッシュ] > [コンピューティング プロファイル] > [コンピューティング プロファイルの作成]* を選択します。
+

NOTE: コンピューティング プロファイルは、展開されるアプライアンスや、HCX サービスにアクセス可能な VMware データセンターの部分などの展開パラメータを定義します。

+
image:gcpd-hcx-011.png["vSphere クライアントの Interconnect ページのスクリーンショット。"]

. コンピューティング プロファイルが作成されたら、*マルチサイト サービス メッシュ > ネットワーク プロファイル > ネットワーク プロファイルの作成* を選択して、ネットワーク プロファイルを作成します。
+
ネットワーク プロファイルは、HCX が仮想アプライアンスに使用する IP アドレスとネットワークの範囲を定義します。

+

NOTE: この手順では 2 つ以上の IP アドレスが必要です。これらの IP アドレスは、管理ネットワークから Interconnect Appliances に割り当てられます。

+
image:gcpd-hcx-012.png["ネットワーク プロファイルのスクリーンショット。"]

. この時点で、コンピューティング プロファイルとネットワーク プロファイルが正常に作成されました。
. *Interconnect* オプション内の *Service Mesh* タブを選択してサービス メッシュを作成し、オンプレミスと GCVE SDDC サイトを選択します。
. サービス メッシュは、ローカルおよびリモートのコンピューティングとネットワーク プロファイルのペアを指定します。
+

NOTE: このプロセスの一環として、安全なトランスポート ファブリックを作成するために、HCX アプライアンスがソース サイトとターゲット サイトの両方に展開され、自動的に構成されます。

+
image:gcpd-hcx-013.png["vSphere クライアントの Interconnect ページの Service Mesh タブのスクリーンショット。"]

. これは設定の最終ステップです。デプロイメントが完了するまでに約 30 分かかります。サービス メッシュが構成されると、ワークロード VM を移行するための IPsec トンネルが正常に作成され、環境が準備されます。
+
image:gcpd-hcx-014.png["vSphere クライアントの相互接続ページにある HCX アプライアンスのスクリーンショット。"]



====
.ステップ6: ワークロードを移行する
[%collapsible%open]
====
さまざまな VMware HCX 移行テクノロジーを使用して、オンプレミスと GCVE SDDC 間でワークロードを双方向に移行できます。  HCX 一括移行、HCX vMotion、HCX コールド移行、HCX レプリケーション アシスト vMotion (HCX Enterprise エディションで利用可能)、HCX OS アシスト移行 (HCX Enterprise エディションで利用可能) などの複数の移行テクノロジーを使用して、VMware HCX がアクティブ化されたエンティティ間で VM を移動できます。

さまざまなHCX移行メカニズムの詳細については、以下を参照してください。 https://cloud.google.com/vmware-engine/docs/workloads/howto-migrate-vms-using-hcx["VMware HCX ドキュメントを使用した VMware VM の移行"^] 。

HCX-IX アプライアンスは、Mobility Agent サービスを使用して、vMotion、Cold、および Replication Assisted vMotion (RAV) の移行を実行します。


NOTE: HCX-IX アプライアンスは、Mobility Agent サービスを vCenter Server のホスト オブジェクトとして追加します。このオブジェクトに表示されるプロセッサ、メモリ、ストレージ、およびネットワーク リソースは、IX アプライアンスをホストする物理ハイパーバイザー上の実際の消費量を表すものではありません。

*HCX vMotion*

このセクションでは、HCX vMotion メカニズムについて説明します。この移行テクノロジーは、VMware vMotion プロトコルを使用して VM を GCVE に移行します。 vMotion 移行オプションは、一度に 1 つの VM の VM 状態を移行するために使用されます。この移行方法ではサービスの中断は発生しません。


NOTE: IP アドレスを変更せずに VM を移行するには、ネットワーク拡張機能 (VM が接続されているポート グループに対して) が配置されている必要があります。

. オンプレミスの vSphere クライアントから [インベントリ] に移動し、移行する VM を右クリックして、[HCX アクション] > [HCX ターゲット サイトに移行] を選択します。
+
image:gcpd-hcx-015.png["入出力ダイアログまたは書かれたコンテンツを示す図"]

. 仮想マシンの移行ウィザードで、リモート サイト接続 (ターゲット GCVE) を選択します。
+
image:gcpd-hcx-016.png["入出力ダイアログまたは書かれたコンテンツを示す図"]

. 必須フィールド (クラスター、ストレージ、宛先ネットワーク) を更新し、[検証] をクリックします。
+
image:gcpd-hcx-017.png["入出力ダイアログまたは書かれたコンテンツを示す図"]

. 検証チェックが完了したら、「Go」をクリックして移行を開始します。
+

NOTE: vMotion 転送では、VM のアクティブ メモリ、実行状態、IP アドレス、MAC アドレスがキャプチャされます。  HCX vMotionの要件と制限の詳細については、以下を参照してください。 https://techdocs.broadcom.com/us/en/vmware-cis/hcx/vmware-hcx/4-10/vmware-hcx-user-guide-4-10/migrating-virtual-machines-with-vmware-hcx/understanding-vmware-hcx-vmotion-and-cold-migration.html#GUID-517866F6-AF06-4EFC-8FAE-DA067418D584-en["VMware HCX vMotion とコールドマイグレーションの理解"^] 。

. HCX > 移行ダッシュボードから、vMotion の進行状況と完了を監視できます。
+
image:gcpd-hcx-018.png["入出力ダイアログまたは書かれたコンテンツを示す図"]




NOTE: ターゲットのGoogle Cloud NetApp Volumes (NetApp Volumes) NFS データストアには、移行を処理するのに十分なスペースが必要です。

====


== まとめ

オールクラウドまたはハイブリッド クラウドを対象としており、データがオンプレミスのあらゆるタイプ/ベンダーのストレージに存在する場合でも、Cloud Volume Service と HCX は、データ要件をアプリケーション層にシームレスにすることで TCO を削減しながら、アプリケーション ワークロードを展開および移行するための優れたオプションを提供します。ユースケースを問わず、Google Cloud VMware Engine と Cloud Volume Service を併せて選択すると、クラウドのメリットを迅速に実現でき、オンプレミスと複数のクラウドにわたる一貫したインフラストラクチャと運用、ワークロードの双方向の移植性、エンタープライズ グレードの容量とパフォーマンスが得られます。これは、VMware vSphere Replication、VMware vMotion、またはネットワーク ファイル コピー (NFC) を使用してストレージを接続し、VMware 仮想マシンを移行するために使用される、使い慣れたプロセスと手順と同じです。



== まとめ

このドキュメントの主なポイントは次のとおりです。

* Google Cloud VMware Engine SDDC 上のデータストアとして Cloud Volume Service を使用できるようになりました。
* オンプレミスから Cloud Volume Service データストアにデータを簡単に移行できます。
* 移行アクティビティ中の容量とパフォーマンスの要件を満たすために、Cloud Volume Service データストアを簡単に拡大および縮小できます。




== 参考としてGoogleとVMwareのビデオ

.Googleから
[%collapsible%open]
====
* link:https://www.youtube.com/watch?v=xZOtqiHY5Uw["GCVE を使用して HCX コネクタをデプロイする"]
* link:https://youtu.be/2ObPvekMlqA["GCVE を使用して HCX ServiceMesh を構成する"]
* link:https://youtu.be/zQSGq4STX1s["HCX を搭載した VM を GCVE に移行する"]


====
.VMwareから
[%collapsible%open]
====
* link:https://youtu.be/EFE5ZYFit3M["GCVE 向け HCX コネクタの展開"]
* link:https://youtu.be/uwRFFqbezIE["GCVE の HCX ServiceMesh 構成"]
* link:https://youtu.be/4KqL0Rxa3kM["HCX ワークロードの GCVE への移行"]


====


== 詳細情報の入手方法

このドキュメントに記載されている情報の詳細については、次の Web サイト リンクを参照してください。

* Google Cloud VMware Engine ドキュメント
+
https://cloud.google.com/vmware-engine/docs/overview/["https://cloud.google.com/vmware-engine/docs/overview"^]

* Cloud Volume Service ドキュメント
+
https://cloud.google.com/architecture/partners/netapp-cloud-volumes["https://cloud.google.com/architecture/partners/netapp-cloud-volumes"^]

* VMware HCX ユーザーガイド
+
https://docs.vmware.com/en/VMware-HCX/index.html["https://docs.vmware.com/en/VMware-HCX/index.html"^]


